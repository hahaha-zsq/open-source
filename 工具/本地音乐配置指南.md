# 🎵 本地音乐配置指南

本指南将详细说明如何在VitePress项目中配置和使用本地音乐文件。

## 📁 文件结构

正确的本地音乐文件结构应该是：

```
项目根目录/
├── public/
│   └── music/
│       ├── 逃跑计划-再飞行.aac     ✅ 已配置
│       ├── song2.mp3
│       ├── song3.wav
│       └── README.md
├── .vitepress/
│   └── theme/
│       └── index.ts              ✅ 配置文件
```

## 🔧 配置步骤

### 1. 添加音乐文件

将音乐文件放到 `public/music/` 目录下：

```bash
# 创建music目录（如果不存在）
mkdir -p public/music

# 将音乐文件复制到该目录
cp your-music-file.mp3 public/music/
```

### 2. 配置播放列表

在 `.vitepress/theme/index.ts` 中配置：

```typescript
const playlist = [
  {
    name: '歌曲名称',
    author: '艺术家',
    file: '/music/文件名.mp3', // 注意：路径以/music/开头，不包含public
  }
]
```

### 3. 当前配置示例

你当前的配置：

```typescript
{
  name: '再飞行',
  author: '逃跑计划',  
  file: '/music/逃跑计划-再飞行.aac', // ✅ 正确的路径格式
}
```

## 🎼 支持的音频格式

| 格式 | 扩展名 | 浏览器支持 | 推荐度 | 说明 |
|------|--------|------------|--------|------|
| **MP3** | .mp3 | 🟢 优秀 | ⭐⭐⭐⭐⭐ | 最佳兼容性，推荐使用 |
| **AAC** | .aac | 🟢 优秀 | ⭐⭐⭐⭐ | 高质量压缩，你正在使用 |
| **WAV** | .wav | 🟢 优秀 | ⭐⭐⭐ | 无损音质，文件较大 |
| **FLAC** | .flac | 🟡 部分 | ⭐⭐ | 无损压缩，支持有限 |
| **OGG** | .ogg | 🟡 部分 | ⭐⭐ | 开源格式，Firefox支持好 |

## 🔍 路径规则详解

### ✅ 正确的路径格式

```typescript
// public/music/song.mp3 对应的配置：
file: '/music/song.mp3'

// public/music/subfolder/song.mp3 对应的配置：
file: '/music/subfolder/song.mp3'
```

### ❌ 错误的路径格式

```typescript
// 错误：包含public前缀
file: '/public/music/song.mp3'

// 错误：没有开头的斜杠
file: 'music/song.mp3'

// 错误：使用相对路径
file: './public/music/song.mp3'
```

## 🎯 实际测试步骤

### 1. 验证文件存在

```bash
# 检查文件是否存在
ls -la public/music/

# 检查文件大小和权限
ls -lh public/music/逃跑计划-再飞行.aac
```

### 2. 测试文件访问

打开浏览器访问：
```
http://localhost:5175/open-source/music/逃跑计划-再飞行.aac
```

如果能直接访问到音频文件，说明路径配置正确。

### 3. 检查播放器

1. 访问你的网站主页
2. 查看右下角是否出现音乐播放器
3. 点击播放按钮测试播放

## 🔧 常见问题排查

### Q1: 音乐播放器不显示？

**可能原因：**
- 主题配置未正确加载
- 插件初始化失败

**解决方案：**
```bash
# 重启开发服务器
npm run docs:dev
```

### Q2: 音乐文件无法播放？

**检查清单：**
- [ ] 文件路径是否正确（`/music/文件名.扩展名`）
- [ ] 文件是否存在于 `public/music/` 目录
- [ ] 文件格式是否被浏览器支持
- [ ] 文件是否损坏

### Q3: 文件名包含中文或特殊字符？

**最佳实践：**
```typescript
// 推荐：使用英文文件名
file: '/music/escape-plan-fly-again.aac'

// 可以：中文文件名（需要URL编码）
file: '/music/逃跑计划-再飞行.aac'
```

## 🚀 性能优化建议

### 1. 文件大小控制

```bash
# 使用ffmpeg压缩音频文件
ffmpeg -i input.wav -b:a 128k output.mp3

# 查看文件大小
ls -lh public/music/
```

### 2. 文件格式选择

- **小文件 (<2MB)**: 使用MP3 128kbps
- **中等文件 (2-5MB)**: 使用MP3 192kbps  
- **高质量 (>5MB)**: 使用MP3 320kbps或AAC

### 3. 加载优化

```typescript
// 可以设置部分歌曲为隐藏，减少初始加载
{
  name: '高质量音乐',
  author: '艺术家',
  file: '/music/high-quality.flac',
  hide: true // 隐藏但可播放
}
```

## 📱 移动端兼容性

### 音频格式支持

| 平台 | MP3 | AAC | WAV | FLAC |
|------|-----|-----|-----|------|
| **iOS Safari** | ✅ | ✅ | ✅ | ❌ |
| **Android Chrome** | ✅ | ✅ | ✅ | ❌ |
| **Desktop Chrome** | ✅ | ✅ | ✅ | ✅ |
| **Desktop Firefox** | ✅ | ✅ | ✅ | ✅ |

### 移动端注意事项

1. **自动播放限制**: 移动端浏览器限制自动播放
2. **数据流量**: 考虑用户的数据流量消耗
3. **电池续航**: 音频播放会消耗电池

## 🎉 成功配置确认

当前你的配置状态：

- ✅ 插件已安装：`vitepress-plugin-music`
- ✅ 文件已放置：`public/music/逃跑计划-再飞行.aac`
- ✅ 路径已修正：`/music/逃跑计划-再飞行.aac`
- ✅ 配置已更新：`.vitepress/theme/index.ts`

现在应该可以正常播放本地音乐了！🎵

---

> 💡 **提示**: 如果遇到问题，可以查看浏览器开发者工具的控制台(Console)和网络(Network)标签页来排查错误。 